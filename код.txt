import os
import threading
import time
from typing import Dict
import telebot
from telebot.types import (
    Message,
    CallbackQuery,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
    WebAppInfo
)


class KIPOBot:
    """
    Telegram-–±–æ—Ç –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –ö–ò–ü–û —Å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–æ—Å—Ç–∞–º–∏ –∏ Mini App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π.
    """

    def __init__(self, token: str):
        self.bot = telebot.TeleBot(token)
        self.user_messages: Dict[int, Dict[str, int]] = {}
        self.user_states: Dict[int, Dict[str, str]] = {}
        self._setup_handlers()
        self._start_scheduled_posts()

    def _setup_handlers(self) -> None:
        """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥ –∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤."""
        self.bot.message_handler(commands=['start'])(self._send_welcome)
        self.bot.callback_query_handler(func=lambda call: True)(self._handle_callback_query)

    def _handle_callback_query(self, call: CallbackQuery) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback-–∑–∞–ø—Ä–æ—Å–æ–≤."""
        chat_id = call.message.chat.id
        data = call.data

        if data == 'learn_more':
            self._show_more_info(call)
        elif data == 'convert_coins':
            self._show_convert_coins(chat_id)
        elif data == 'connect_wallet':
            self._show_connect_wallet(chat_id)
        elif data == 'wallet_problems':
            self._show_wallet_problems(chat_id)
        elif data == 'problems':
            self._show_problems(chat_id)
        elif data == 'back':
            self._go_back(chat_id)
        elif data == 'back_wallet':
            self._go_back_to_wallet(chat_id)
        elif data == 'start_test':
            self._start_test(call)

    def _start_test(self, call: CallbackQuery) -> None:
        """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞."""
        chat_id = call.message.chat.id
        text = "–¢–µ—Å—Ç –Ω–∞—á–∞–ª—Å—è! –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤."

        try:
            self.bot.answer_callback_query(call.id, text="–¢–µ—Å—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...")
            sent_msg = self.bot.send_message(chat_id, text)
            self._save_message(chat_id, "test", sent_msg.message_id)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–∞: {e}")

    def _start_scheduled_posts(self) -> None:
        """–ó–∞–ø—É—Å–∫ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö."""
        threading.Thread(target=self._schedule_post1, daemon=True).start()
        threading.Thread(target=self._schedule_post2, daemon=True).start()
        threading.Thread(target=self._schedule_post3, daemon=True).start()

    def _schedule_post1(self) -> None:
        """–ü–µ—Ä–≤—ã–π –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ—Å—Ç —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É."""
        time.sleep(60)
        for chat_id in list(self.user_messages.keys()):
            text = """
            –¢—ã –º–µ—á—Ç–∞–µ—à—å –æ –∑–Ω–∞–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å?

–•–æ—á–µ—à—å —É—á–∏—Ç—å—Å—è –≤ –º–µ—Å—Ç–µ, –≥–¥–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ —à–∞–≥ –∫ —É—Å–ø–µ—Ö—É –∏ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º? –ù–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —à–∫–æ–ª–∞ –∏–ª–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç, —ç—Ç–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤, –≥–¥–µ —Ç–≤–æ–∏ —Ç–∞–ª–∞–Ω—Ç—ã —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è, –∞ –º–µ—á—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é üèÜ

–í –Ω–∞—à–µ–º –≤–∏–¥–µ–æ —Ç—ã —É–≤–∏–¥–∏—à—å, –∫–∞–∫ –∂–∏–≤—ë—Ç –Ω–∞—à–µ _—É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ_, –ø–æ–∑–Ω–∞–∫–æ–º–∏—à—å—Å—è —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç, –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è —Å—Ç—Ä–æ—è—Ç —Å–≤–æ—ë —É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤—Ç—Ä–∞. –£–∑–Ω–∞–µ—à—å –æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –∏ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ, –≥–¥–µ —É—á—ë–±–∞ ‚Äî _—ç—Ç–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ._

–ù–µ —É–ø—É—Å—Ç–∏ —à–∞–Ω—Å –∑–∞–≥–ª—è–Ω—É—Ç—å –∑–∞ –∫—É–ª–∏—Å—ã –∏ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –¥—É—Ö –Ω–∞—à–µ–≥–æ —É—á–µ–±–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è! –ù–∞–∂–º–∏ –Ω–∞ –≤–∏–¥–µ–æ –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ—ë –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ *–ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!*
    """
            keyboard = InlineKeyboardMarkup()
            keyboard.add(InlineKeyboardButton("–°–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ", url="https://rutube.ru/video/5e7bfa3bbf7bdca8d76fcb1aeab39610/"))

            self._replace_message(
                chat_id=chat_id,
                new_text=text,
                new_photo=os.path.join('image', 'KIPOhh.jpg'),
                keyboard=keyboard,
                tag="post1"
            )

    def _schedule_post2(self) -> None:
        """–í—Ç–æ—Ä–æ–π –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ—Å—Ç —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã."""
        time.sleep(120)
        for chat_id in list(self.user_messages.keys()):
            text = """
*–ö–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è —Ç–µ–±–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç* üë®‚Äçüéì

–ü—Ä–æ–π–¥–∏ –º–∏–Ω–∏ —Ç–µ—Å—Ç –∏ —É–∑–Ω–∞–π –∫–∞–∫–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —Ç–µ–±–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –≤ –Ω–∞—à–µ–º —É—á–µ–±–Ω–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏
            """
            keyboard = InlineKeyboardMarkup()
            keyboard.add(InlineKeyboardButton("–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç", callback_data='start_test'))

            self._replace_message(
                chat_id=chat_id,
                new_text=text,
                new_photo=os.path.join('image', 'KIPOPROF.jpg'),
                keyboard=keyboard,
                tag="post2"
            )


    def _schedule_post3(self) -> None:
        """–¢—Ä–µ—Ç–∏–π –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ—Å—Ç —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã."""
        time.sleep(180)
        for chat_id in list(self.user_messages.keys()):
            text = "*–£–∑–Ω–∞–π—Ç–µ –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–ª–æ–≥–æ–≤—ã–π –≤—ã—á–µ—Ç –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ*üìÉ"
            keyboard = InlineKeyboardMarkup()
            keyboard.add(InlineKeyboardButton("–ü–æ–¥—Ä–æ–±–Ω–µ–µ", url="https://www.nalog.gov.ru/rn77/taxation/taxes/ndfl/nalog_vichet/soc_nv/soc_nv_ob/?ysclid=m9vr99vkec676799796"))

            self._replace_message(
                chat_id=chat_id,
                new_text=text,
                new_photo=os.path.join('image', 'KIPOHALOG.jpg'),
                keyboard=keyboard,
                tag="post3"
            )

    def _replace_message(self, chat_id: int, new_text: str, new_photo: str,
                         keyboard: InlineKeyboardMarkup, tag: str) -> None:
        """–ó–∞–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ–≤—ã–º."""
        try:
            # –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            if tag in self.user_messages.get(chat_id, {}):
                try:
                    self.bot.delete_message(chat_id, self.user_messages[chat_id][tag])
                except Exception as e:
                    print(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}")

            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(new_photo, 'rb'),
                caption=new_text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, tag, sent_msg.message_id)

        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

    def _send_welcome(self, message: Message) -> None:
        """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏."""
        welcome_text = """
*–î–æ–±—Ä–æ –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ë–æ—Ç–∞ –æ—Ç –õ—É—á—à–µ–≥–æ –£—á–µ–±–Ω–æ–≥–æ –£—á—Ä–µ–∂–¥–µ–Ω–∏—è –ö–ò–ü–û üî•*

–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –≤ –Ω–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ.
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton(
                "–û–¢–ö–†–´–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–ï",
                web_app=WebAppInfo(url="https://sergei-dott.github.io/KIPOclicke/")
            ),
            InlineKeyboardButton("–£–∑–Ω–∞—Ç—å"
                                 " –±–æ–ª—å—à–µ", callback_data='learn_more')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=message.chat.id,
                photo=open(os.path.join('image', 'KIPOGRA.jpg'), 'rb'),
                caption=welcome_text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(message.chat.id, "welcome", sent_msg.message_id)
            self._save_state(message.chat.id, "last_post", "welcome")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ welcome —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

    def _show_more_info(self, call: CallbackQuery) -> None:
        """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ –º–æ–Ω–µ—Ç."""
        chat_id = call.message.chat.id
        info_text = """
–í —ç—Ç–æ–º –±–æ—Ç–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–æ–Ω–µ—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –Ω–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ.

*–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ?*

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ —ç—Ç–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –Ω–∞–±—Ä–∞—Ç—å –º–æ–Ω–µ—Ç –≤ –Ω–∞—à–µ–º Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —á–µ–º –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç —Ç–µ–º –≤—ã—à–µ —Å–∫–∏–¥–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ.
*–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∫–∏–¥–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 15%*.

–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –≤ Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏–µ 15% –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å 
~ *500 000 –º–æ–Ω–µ—Ç* –∏ –±–æ–ª—å—à–µ.

–ù–æ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ  –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –º–µ–Ω—å—à–µ—é —Å–∫–∏–¥–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞–±—Ä–∞–≤ –ø—Ä–∏ —ç—Ç–æ–º 
~ *100 000 –º–æ–Ω–µ—Ç* –∏ –±–æ–ª—å—à–µ, —á—Ç–æ –≤ –∏—Ç–æ–≥–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É –≤ —Ä–∞–∑–º–µ—Ä–µ 10%

–ï—Å–ª–∏ –≤—ã –Ω–∞–±—Ä–∞–ª–∏ –º–µ–Ω—å—à–µ —á–µ–º 
*100 000, –Ω–æ –±–æ–ª—å—à–µ —á–µ–º 50 000 –º–æ–Ω–µ—Ç*, —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å 5% —Å–∫–∏–¥–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ. –í –∏–Ω–æ–º —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≤–∞—à –±–∞–ª–∞–Ω—Å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç *50 000 –º–æ–Ω–µ—Ç - 30 000 –º–æ–Ω–µ—Ç*, —Ç–æ —Ä–∞–∑–º–µ—Ä –≤–∞—à–µ–π —Å–∫–∏–¥–∫–∏ —Å–æ—Å—Ç–∞–≤–∏—Ç 3%
–í –¥—Ä—É–≥–æ–º —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω–µ–µ *30 000 –º–æ–Ω–µ—Ç*, —Ç–æ –±–∞–ª–ª—ã –±—É–¥—É—Ç –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã üòî
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton("–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–Ω–µ—Ç", callback_data='convert_coins'),
            InlineKeyboardButton("–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫—Ä–∏–ø—Ç–æ"
                                 " –∫–æ—à–µ–ª–µ–∫", callback_data='connect_wallet')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'KIPOCKIDDD.jpg'), 'rb'),
                caption=info_text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "info", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "info")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {e}")

    def _show_convert_coins(self, chat_id: int) -> None:
        """–ü–æ—Å—Ç –æ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º–æ–Ω–µ—Ç."""
        text = """
*–ö–∞–∫ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–Ω–µ—Ç—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ —Å–∫–∏–¥–∫–µ ?*

–î–ª—è —ç—Ç–æ–≥–æ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–ª–ª–æ–≤ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏. –ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å _–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞_ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ä—Ç–µ, –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç _–±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ_. 
–î–∞–ª–µ–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã, –Ω–∞ –≤–∞—à –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª—ë–∫ –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–æ N –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã *KIPO*, —ç—Ç–æ —Å—É–º–º–∞ –∏ –±—É–¥–µ—Ç —è–≤–ª—è—Ç—å—Å—è –≤–∞—à–µ–π —Å–∫–∏–¥–∫–æ–π –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ.
–ß—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤–∞–º –º–æ–Ω–µ—Ç—ã *KIPO*, –≤–æ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ø–æ–¥–∞—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –Ω–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ, –≤—ã –±—É–¥–µ—Ç–µ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–µ–º–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏ —Å—É–º–º—É –≤–∞—à–∏—Ö –Ω–∞–±—Ä–∞–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç –≤ —Å–∞–º–æ–º –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª–∫–µ.
 –ï—Å–ª–∏ –≤—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —ç—Ç–∞–ø—ã —É—Å–ø–µ—à–Ω–æ, —Ç–æ –º—ã –≤–∞—Å –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã –≤—ã—á–ª–∏ N % –æ—Ç —Å—É–º–º—ã üòÄ
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton("–í–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã", callback_data='problems'),
            InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥", callback_data='back')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'KIPOCKID.jpg'), 'rb'),
                caption=text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "convert", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "convert")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: {e}")

    def _show_connect_wallet(self, chat_id: int) -> None:
        """–ü–æ—Å—Ç –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞."""
        text = """
*–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª—ë–∫ –∫ –Ω–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é ?*

1. –°–∫–∞—á–∏–≤–∞–µ–º –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫—Ä–∏–ø—Ç–æ –∫–æ—à–µ–ª—ë–∫ _MetaMask_.

2. –ü—Ä–æ—Ö–æ–¥–∏–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ—à–µ–ª–µ–∫. *–ü—Ä–∏–º–µ—á–∞–Ω–∏–∏*: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–≤–æ—é Seed - —Ñ—Ä–∞–∑—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ 12 —Å–ª–æ–≤–æ, –Ω–∏–∫–æ–º—É –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ –∏ –Ω–µ –≥–æ–≤–æ—Ä–∏—Ç–µ –≤–∞—à—É —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Ñ—Ä–∞–∑—É. –ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω–∞—è —Ñ—Ä–∞–∑–∞ –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω–∞ —Ç–æ –≤–∞—à–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã, –±—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã.

3. –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –∫–æ—à–µ–ª–µ–∫.

4. –°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º –±—É–¥–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Å–≤–æ–µ–≥–æ –æ–±—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞. _–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å_ –∞–¥—Ä–µ—Å —Å–≤–æ–µ–≥–æ –∫–æ—à–µ–ª–µ–∫ –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

5. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ –æ–±—â–µ–π –∞–¥—Ä–µ—Å —Å–≤–æ–µ–≥–æ –∫–æ—à–µ–ª–∫–∞, –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–∞–∂–∏–º–∞–µ—Ç–µ –≤–∫–ª–∞–¥–∫—É –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º _"–∫–æ—à–µ–ª–µ–∫"_, –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª–∫–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ.

–ï—Å–ª–∏ —Å–¥–µ–ª–∞–ª–∏ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ç–æ  *–º—ã –≤–∞—Å –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º* –≤—ã  —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ —Å–≤–æ–π –∫–æ—à–µ–ª–µ–∫ –∫ –Ω–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, —á—Ç–æ –≤—Å–∫–æ—Ä–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å _—Å–≤–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ_ üòÄ
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton("–°–∫–∞—á–∞—Ç—å MetaMask", url="https://metamask.io/download.html"),
            InlineKeyboardButton("–ü–æ—à–∞–≥–æ–≤–æ–µ "
                                 "–≤–∏–¥–µ–æ", url="https://rutube.ru/shorts/44930c106504842c9e0cc6ad03858df2?r=wd")
        )
        keyboard.row(
            InlineKeyboardButton("–í–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã", callback_data='wallet_problems'),
            InlineKeyboardButton(" –í–µ—Ä–Ω—É—Ç—å—Å—è"
                                 " –Ω–∞–∑–∞–¥", callback_data='back')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'KIPOKOSH.jpg'), 'rb'),
                caption=text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "wallet", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "wallet")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ—à–µ–ª—å–∫–µ: {e}")

    def _show_wallet_problems(self, chat_id: int) -> None:
        """–ü–æ—Å—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–æ—à–µ–ª—å–∫–æ–º."""
        text = """–ü–æ—è–≤–∏–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ—à–µ–ª—å–∫–∞ —Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ –Ω–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É: KIPO@clicker.gmail.com
–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ—Å—Ç—É–ø–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –¥–Ω—è.
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.add(InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥", callback_data='back_wallet'))

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'OPERATOR.jpg'), 'rb'),
                caption=text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "wallet_problems", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "wallet_problems")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ—à–µ–ª—å–∫–æ–º: {e}")

    def _show_problems(self, chat_id: int) -> None:
        """–ü–æ—Å—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö."""
        text = """
        –ü–æ—è–≤–∏–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–æ—à–µ–ª—å–∫–∞ —Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ –Ω–∞—à—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É: KIPO@clicker.gmail.com
 –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ—Å—Ç—É–ø–∏—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –¥–Ω—è.
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.add(InlineKeyboardButton("–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥", callback_data='back'))

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'OPERATOR.jpg'), 'rb'),
                caption=text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "problems", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "problems")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø—Ä–æ–±–ª–µ–º: {e}")

    def _go_back(self, chat_id: int) -> None:
        """–í–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø–æ—Å—Ç—É."""
        last_post = self.user_states.get(chat_id, {}).get("last_post", "welcome")

        current_post = None
        target_post = "welcome"

        if last_post == "convert":
            current_post = "convert"
            target_post = "info"
        elif last_post == "problems":
            current_post = "problems"
            target_post = "convert"
        elif last_post == "wallet":
            current_post = "wallet"
            target_post = "info"
        elif last_post == "info":
            current_post = "info"
            target_post = "welcome"
        elif last_post == "wallet_problems":
            current_post = "wallet_problems"
            target_post = "wallet"

        if current_post and current_post in self.user_messages.get(chat_id, {}):
            try:
                self.bot.delete_message(chat_id, self.user_messages[chat_id][current_post])
            except Exception as e:
                print(f"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: {e}")

        if target_post == "info":
            self._show_more_info_again(chat_id)
        elif target_post == "convert":
            self._show_convert_coins(chat_id)
        elif target_post == "wallet":
            self._show_connect_wallet(chat_id)
        elif target_post == "welcome":
            self._send_welcome_again(chat_id)

    def _go_back_to_wallet(self, chat_id: int) -> None:
        """–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø—Ä–æ–±–ª–µ–º –∫–æ—à–µ–ª—å–∫–∞."""
        self._go_back(chat_id)

    def _show_more_info_again(self, chat_id: int) -> None:
        """–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏."""
        info_text = """
–í —ç—Ç–æ–º –±–æ—Ç–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–æ–Ω–µ—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –Ω–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ.

*–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ?*

–í–∞—à–∞ –∑–∞–¥–∞—á–∞ —ç—Ç–æ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –Ω–∞–±—Ä–∞—Ç—å –º–æ–Ω–µ—Ç –≤ –Ω–∞—à–µ–º Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, —á–µ–º –±–æ–ª—å—à–µ –º–æ–Ω–µ—Ç —Ç–µ–º –≤—ã—à–µ —Å–∫–∏–¥–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ.
*–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Å–∫–∏–¥–∫–∞ –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 15%*.

–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –≤ Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏–µ 15% –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å 
~ *500 000 –º–æ–Ω–µ—Ç* –∏ –±–æ–ª—å—à–µ.

–ù–æ —Ç–∞–∫ –∂–µ –º–æ–∂–Ω–æ  –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª–µ–µ –º–µ–Ω—å—à–µ—é —Å–∫–∏–¥–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞–±—Ä–∞–≤ –ø—Ä–∏ —ç—Ç–æ–º 
~ *100 000 –º–æ–Ω–µ—Ç* –∏ –±–æ–ª—å—à–µ, —á—Ç–æ –≤ –∏—Ç–æ–≥–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É –≤ —Ä–∞–∑–º–µ—Ä–µ 10%

–ï—Å–ª–∏ –≤—ã –Ω–∞–±—Ä–∞–ª–∏ –º–µ–Ω—å—à–µ —á–µ–º 
*100 000, –Ω–æ –±–æ–ª—å—à–µ —á–µ–º 50 000 –º–æ–Ω–µ—Ç*, —Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å 5% —Å–∫–∏–¥–∫—É –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ. –í –∏–Ω–æ–º —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≤–∞—à –±–∞–ª–∞–Ω—Å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç *50 000 –º–æ–Ω–µ—Ç - 30 000 –º–æ–Ω–µ—Ç*, —Ç–æ —Ä–∞–∑–º–µ—Ä –≤–∞—à–µ–π —Å–∫–∏–¥–∫–∏ —Å–æ—Å—Ç–∞–≤–∏—Ç 3%
–í –¥—Ä—É–≥–æ–º —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω–µ–µ *30 000 –º–æ–Ω–µ—Ç*, —Ç–æ –±–∞–ª–ª—ã –±—É–¥—É—Ç –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω—ã üòî
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton("–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–æ–Ω–µ—Ç", callback_data='convert_coins'),
            InlineKeyboardButton("–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫—Ä–∏–ø—Ç–æ"
                                 " –∫–æ—à–µ–ª–µ–∫", callback_data='connect_wallet')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'KIPO100.jpg'), 'rb'),
                caption=info_text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "info", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "info")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: {e}")

    def _send_welcome_again(self, chat_id: int) -> None:
        """–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è."""
        welcome_text = """
*–î–æ–±—Ä–æ –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ë–æ—Ç–∞ –æ—Ç –õ—É—á—à–µ–≥–æ –£—á–µ–±–Ω–æ–≥–æ –£—á—Ä–µ–∂–¥–µ–Ω–∏—è –ö–ò–ü–û üî•*

–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –¥–ª—è –Ω–∞–∏–±–æ–ª—å—à–µ–≥–æ —à–∞–Ω—Å–∞ –ø–æ—Å—Ç—É–ø–∏—Ç—å –≤ –Ω–∞—à–µ —É—á–µ–±–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ.
        """

        keyboard = InlineKeyboardMarkup()
        keyboard.row(
            InlineKeyboardButton(
                "–û–¢–ö–†–´–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–ï",
                web_app=WebAppInfo(url="https://sergei-dott.github.io/KIPOclicke/")
            ),
            InlineKeyboardButton("–£–∑–Ω–∞—Ç—å "
                                 "–±–æ–ª—å—à–µ", callback_data='learn_more')
        )

        try:
            sent_msg = self.bot.send_photo(
                chat_id=chat_id,
                photo=open(os.path.join('image', 'KIPOGRA.jpg'), 'rb'),
                caption=welcome_text,
                reply_markup=keyboard,
                parse_mode='Markdown'
            )
            self._save_message(chat_id, "welcome", sent_msg.message_id)
            self._save_state(chat_id, "last_post", "welcome")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ welcome —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

    def _save_message(self, chat_id: int, tag: str, message_id: int) -> None:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç ID —Å–æ–æ–±—â–µ–Ω–∏—è."""
        if chat_id not in self.user_messages:
            self.user_messages[chat_id] = {}
        self.user_messages[chat_id][tag] = message_id

    def _save_state(self, chat_id: int, key: str, value: str) -> None:
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
        if chat_id not in self.user_states:
            self.user_states[chat_id] = {}
        self.user_states[chat_id][key] = value

    def run(self) -> None:
        """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞."""
        print("–ë–æ—Ç –ö–ò–ü–û –∑–∞–ø—É—â–µ–Ω! –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C")
        self.bot.infinity_polling()


if __name__ == '__main__':
    TOKEN = ''
    bot = KIPOBot(TOKEN)
    bot.run()